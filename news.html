<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Palestine News - Live Updates</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* News page specific mobile styles */
        @media (max-width: 768px) {
            .container {
                width: 100%;
                padding: 1rem;
                margin: 0;
            }
            
            .news-card {
                padding: 1rem;
                margin: 0.8rem 0;
            }
            
            .news-card h3 {
                font-size: 1.1rem;
            }
            
            .news-card p {
                font-size: 0.9rem;
            }
            
            #update-status {
                font-size: 0.8rem;
                padding: 0.3rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav-links">
            <a href="index.html">Support Palestine</a>
            <a href="dashboard.html">View Dashboard</a>
            <a href="news.html" class="active">Latest News</a>
            <a href="about.html">About</a>
        </nav>
    </header>

    <div class="container">
        <h1>Live Updates: Palestine News</h1>
        <div id="update-status" class="update-status"></div>
        <div id="news-container">
            <div id="loading">Loading latest news...</div>
        </div>
    </div>

    <script src="news.js"></script>
    <script>
        const apiKey = '79543b40144a4111292290a10f6ff7f4';
        const newsCache = new NewsCache();
        let updateTimer;

        async function loadNews(isAutoRefresh = false) {
            const container = document.getElementById('news-container');
            const statusDiv = document.getElementById('update-status');
            
            try {
                const articles = await newsCache.loadNews(apiKey);
                
                if (articles) {
                    container.innerHTML = '';
                    articles.forEach(article => {
                        const div = document.createElement('div');
                        div.className = 'news-card';
                        div.innerHTML = `
                            <h3><a href="${article.url}" target="_blank">${article.title}</a></h3>
                            <p>${article.description || ''}</p>
                            <small>Published: ${new Date(article.publishedAt).toLocaleString()}</small>
                            <hr>
                            <small>Source: ${article.source.name}</small>
                        `;
                        container.appendChild(div);
                    });

                    updateNextRefreshTimer();
                }
            } catch (error) {
                container.innerHTML = `<div class="error">Failed to load news: ${error.message}</div>`;
            }
        }

        function updateNextRefreshTimer() {
            const cached = newsCache.getCachedNews();
            if (cached) {
                const nextUpdate = new Date(cached.timestamp + newsCache.CACHE_DURATION);
                const updateDiv = document.getElementById('update-status');
                
                clearInterval(updateTimer);
                updateTimer = setInterval(() => {
                    const now = new Date();
                    const diff = nextUpdate - now;
                    if (diff <= 0) {
                        loadNews(true); // Auto refresh when time is up
                    } else {
                        const minutes = Math.floor(diff / 60000);
                        const seconds = Math.floor((diff % 60000) / 1000);
                        updateDiv.textContent = `Next update in: ${minutes}m ${seconds}s`;
                    }
                }, 1000);
            }
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', () => loadNews());
    </script>
    <script src="update-footer.js"></script>
</body>
</html>
